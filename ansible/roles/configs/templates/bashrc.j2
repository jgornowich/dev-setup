# ~/.bashrc: executed by bash(1) for non-login shells.

# If not running interactively, don't do anything
case $- in
    *i*) ;;
      *) return;;
esac

# Source global definitions
if [ -f /etc/bashrc ]; then
    . /etc/bashrc
fi

# User specific environment
if ! [[ "$PATH" =~ "{{ ansible_user_dir }}/.local/bin:{{ ansible_user_dir }}/bin:" ]]
then
    PATH="{{ ansible_user_dir }}/.local/bin:{{ ansible_user_dir }}/bin:$PATH"
export PATH
fi

# Load aliases
if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

# Load git aliases
if [ -f ~/.git_aliases ]; then
    . ~/.git_aliases
fi

# Load kubectl aliases
if [ -f ~/.kubectl_aliases ]; then
    . ~/.kubectl_aliases
fi

# Set default editor
export EDITOR=nvim

# Set up Go
if [ -d "/usr/local/go/bin" ] ; then
    export PATH="$PATH:/usr/local/go/bin"
    export GOPATH="{{ ansible_user_dir }}/go"
    export PATH="$PATH:$GOPATH/bin"
fi

# Set up Rust
if [ -f "{{ ansible_user_dir }}/.cargo/env" ]; then
    . "{{ ansible_user_dir }}/.cargo/env"
fi

# Set up NVM
if [ -s "{{ ansible_user_dir }}/.nvm/nvm.sh" ]; then
    export NVM_DIR="{{ ansible_user_dir }}/.nvm"
    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
    [ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"
fi

# Enable color support
if [ -x /usr/bin/dircolors ]; then
    test -r ~/.dircolors && eval "$(dircolors -b ~/.dircolors)" || eval "$(dircolors -b)"
    alias ls='ls --color=auto'
    alias grep='grep --color=auto'
    alias fgrep='fgrep --color=auto'
    alias egrep='egrep --color=auto'
fi

# Some more ls aliases
alias ll='ls -alFh'
alias la='ls -A'
alias l='ls -CF'

# Add an "alert" alias for long running commands
alias alert='notify-send --urgency=low -i "$([ $? = 0 ] && echo terminal || echo error)" "$(history|tail -n1|sed -e '\''s/^\s*[0-9]\+\s*//;s/[;&|]\s*alert$//'\'')"'

# Enable programmable completion features
if ! shopt -oq posix; then
  if [ -f /usr/share/bash-completion/bash_completion ]; then
    . /usr/share/bash-completion/bash_completion
  elif [ -f /etc/bash_completion ]; then
    . /etc/bash_completion
  fi
fi

# Starship prompt
if command -v starship &> /dev/null; then
    eval "$(starship init bash)"
fi

# FZF configuration
export FZF_DEFAULT_OPTS='--height 40% --layout=reverse --border'
[ -f ~/.fzf.bash ] && source ~/.fzf.bash

# Custom functions
function mkcd() {
    mkdir -p "$1" && cd "$1" || return
}

# Load local bashrc if it exists
if [ -f ~/.bashrc.local ]; then
    . ~/.bashrc.local
fi
